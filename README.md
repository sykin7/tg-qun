Telegram 匿名多群转发机器人

这是一个专为匿名消息转发而设计的 Telegram 机器人。

您（管理员）可以通过私聊向机器人发送消息，机器人会将这些消息（文字、图片、文件等）匿名地复制到一个或多个您指定的群组中。群组中的人无法知道消息是您发送的，只会看到机器人（用您伪装的名字）发送了消息。

功能特性

模式切换：使用 /set <别名> 锁定目标群组，之后所有消息（包括图片、文件）都会自动匿名转发。

完全匿名：使用 copy_message 机制，群组内看不到任何“转发自”或您的个人信息。

多群管理：通过 GROUP_MAP 环境变量，您可以为您所有的群组设置简单易记的“别名”。

快速发送：使用 /to <别名> <内容> 来快速发送临时的纯文本消息，不影响当前锁定的模式。

部署友好：使用 Dockerfile 和 GitHub Actions 自动构建镜像，可一键部署到 Leaflow 等云平台。

部署流程 (Leaflow 平台)

本指南假定您使用 Leaflow 平台和 GitHub Actions 自动构建镜像。

阶段一：部署前准备 (获取令牌)

在开始之前，您需要获取两个关键信息：

BOT_TOKEN (机器人令牌)

去 Telegram 搜索 @BotFather。

发送 /newbot，按照提示创建一个机器人。

@BotFather 会给您一长串的 Token（例如 123456:ABC-DEF）。复制它。

ADMIN_USER_ID (您的管理员ID)

去 Telegram 搜索 @userinfobot。

给它发送任意消息，它会回复您的个人信息。

找到 Id: 后面那串纯数字（例如 12345678）。复制它。

阶段二：GitHub 自动构建镜像

确保您的 GitHub 仓库中包含 bot.py, requirements.txt, Dockerfile 和 .github/workflows/build-docker.yml 这四个文件。

将代码推送到 main 分支，GitHub Actions 会自动开始构建 Docker 镜像。

在 GitHub 仓库主页，点击 "Actions" 标签页，等待工作流出现绿色对勾 ✅。

回到仓库主页，点击右侧的 "Packages"，找到您刚构建的镜像。

点击镜像名称，进入 "Package settings" (包设置)，将可见性 (Visibility) 修改为 "Public" (公开)。

复制该页面的镜像路径，它看起来像：ghcr.io/您的用户名/您的仓库名:latest。

阶段三：Leaflow 首次部署 (获取群组ID)

登录 Leaflow，创建一个新服务。

选择 “从 Docker 镜像部署”。

在“镜像名称”处，粘贴您在阶段二复制的镜像路径（例如 ghcr.io/username/repo:latest）。

找到 “环境变量” (Environment Variables) 部分，添加两个变量：

BOT_TOKEN: (粘贴您在阶段一获取的机器人令牌)

ADMIN_USER_ID: (粘贴您在阶段一获取的您的个人ID)

点击 “部署”。

等待服务变为 "Running" (运行中)。

把您的机器人拉进所有您想转发消息的目标群组（例如 g1 群和 g2 群）。

在 g1 群里，发送命令 /getid。机器人会回复 g1 群的 ID（例如 -100123456）。复制这个ID。

在 g2 群里，发送命令 /getid。机器人会回复 g2 群的 ID。复制这个ID。

阶段四：Leaflow 最终部署 (配置群组)

回到 Leaflow 您的服务设置中，找到 “环境变量”。

添加第三个，也是最后一个变量：

GROUP_MAP: (填入您规划好的“别名地图”)

格式：别名1:ID1,别名2:ID2,别名3:ID3

示例：g1:-100123456,g2:-100789012

保存环境变量，然后点击 "Redeploy" (重新部署)。

详细使用方法

等待服务重新部署并变为 "Running" 后，您的机器人就完全配置好了。

所有操作均在您（管理员）与机器人的【私聊】窗口中进行：

发送 /start

机器人回复：列出所有它识别的别名 (例如 g1, g2)。

发送 /set g1 (设置模式为 g1)

机器人回复：“✅ 已切换... g1”。

发送一张图片 (可以带说明，也可以不带)

立即查看 g1 群：机器人（用您伪装的名字）在群里发了这张图片。

发送纯文本 这是g1的测试

立即查看 g1 群：机器人发了 这是g1的测试。

发送 /set g2 (切换模式到 g2)

机器人回复：“✅ 已切换... g2”。

发送一个文件

立即查看 g2 群：机器人发了这个文件。

发送 /who (检查当前模式)

机器人回复：“ℹ️ 当前消息目标群组是: g2”。

发送 /to g1 这是一条给g1的临时文本 (临时快速发送)

立即查看 g1 群：机器人发了 这是一条给g1的临时文本。

再次发送 /who

机器人回复：“ℹ️ 当前消息目标群组是: g2”。 (证明 /to 命令不会改变您用 /set 设定的模式)。

发送 /set none (取消所有模式)

机器人回复：“✅ 模式已取消。”

发送 这条消息不会被转发

（查看 g1 和 g2 群）：什么也没发生。转发已停止。

许可证 (License)

本项目采用 GPL 3.0 许可证。
